---
title: go-GPM模型
date: 2021-11-19
categories: go
tags: [go, gpm]
description: 关键词：进程、线程、协程、GPM
---

## 进程/线程/协程

说到GPM，进程、线程、协程是绕不开的话题。web服务器经历了从进程处理请求模型（代表作php），再到用线程处理请求模型（代表作Java、.Net），后来出现风靡一时的Node.js用“事件”的方式处理请求模型，现如今golang带起来的协程，请求处理模型一代比一代先进，把服务器资源更充分的利用在有意义的事情上，使得服务性能得到一次又一次提升。  

进程：进程是系统进行资源分配的基本单位，有独立的内存空间，进程的管理模块为PCB。

线程：线程是 CPU 调度和分派的基本单位，线程依附于进程存在，每个线程会共享父进程的资源，线程的管理模块为TCB。

CPU在上下文切换时，PCB消耗的资源远大于TCB，所以诞生了用线程处理请求的模型，绕开了PCB。 一个线程的最小占用内存是2M，在使用线程模型并发处理请求时，CPU大量的时间片会消耗在TCB上。想要提高服务器并发处理的性能，就要绕开TCB。

Node.js的思路是在单进程上利用`事件驱动`+`非阻塞IO`来处理请求，这种模型中上下文的切换是在单线程下完成的，也就没有了CPU时间片在PCB和TCB上的消耗。缺陷是难以利用CPU多核，加上JavaScript的历史包袱，最终也只是风靡一时。

协程：是一种用户态的轻量级线程，最小占用内存只有2kb，协程的调度完全由用户控制，没有内核的开销，省去了PCB和TCB需要消耗的CPU时间片。

虽然其他语言（python和php-swoole的coroutine）也逐渐引入了协程库的概念，但在协程的调度上，golang是在语言级别实现，用更少的CPU指令完成了协程的调度，这个调度也就是我们现在常叫的GPM模型。

待续...


## 参考文献
[Golang的协程调度器原理及GMP设计思想](https://www.kancloud.cn/aceld/golang/1958305)